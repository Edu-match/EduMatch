/**
 * 記事タグの最適化（15〜20個に大統合版）
 * 最終カテゴリ: AI, ICT, 教育, 塾, 学習, 受験, 小学校, 中学, 高校, 大学, 
 * 英語, プログラミング, オンライン, セミナー, 保護者, 教員, 教材, 補助金, 地域
 */

const fs = require("fs");
const path = require("path");

const inputPath = path.join(__dirname, "../data/article-tags-sorted.txt");
const raw = fs.readFileSync(inputPath, "utf-8");
let tags = raw.split("\n").map((s) => s.trim()).filter(Boolean);

// 最終的に残す20個のカテゴリ
const FINAL_CATEGORIES = [
  "AI", "ICT", "教育", "塾", "学習", "受験", 
  "小学校", "中学", "高校", "大学", "英語", "プログラミング",
  "オンライン", "セミナー", "保護者", "教員", "教材", "補助金", "地域"
];

// ほぼすべてを上記カテゴリにマッピング
const normalizeMap = {
  // AI系 → AI
  "AI活用": "AI",
  "AI教育": "AI",
  "AI HEROES COLLECTION": "AI",
  "AIUEO": "AI",
  "AIアバター": "AI",
  "AIアプリ": "AI",
  "AIエージェント": "AI",
  "AIエンジニア": "AI",
  "AIコンサルタント": "AI",
  "AIコンテンツ制作": "AI",
  "AIサンタ": "AI",
  "AIセミナー": "AI",
  "AIソリューション": "AI",
  "AIチャット": "AI",
  "AIチャンピオンシップ": "AI",
  "AIチューター": "AI",
  "AIツール": "AI",
  "AIデータ": "AI",
  "AIなりすまし": "AI",
  "AIの使用例": "AI",
  "AIハッカソン": "AI",
  "AIメンタリングシステム": "AI",
  "AIモード": "AI",
  "AIリスク": "AI",
  "AIリテラシー": "AI",
  "AI映像分析": "AI",
  "AI英語教育": "AI",
  "AI学習支援": "AI",
  "AI共育ラボ": "AI",
  "AI教育プログラム": "AI",
  "AI教育活用": "AI",
  "AI教材": "AI",
  "AI効率化": "AI",
  "AI講師": "AI",
  "AI採点": "AI",
  "AI時代の教育": "AI",
  "AI失敗談": "AI",
  "AI成功事例": "AI",
  "AI先生": "AI",
  "AI戦略": "AI",
  "AI通訳機": "AI",
  "AI統合": "AI",
  "AI導入": "AI",
  "AI導入の課題": "AI",
  "AI部": "AI",
  "AI面接官": "AI",
  "生成AI": "AI",
  "生成AIガイドライン": "AI",
  "生成AI協会": "AI",
  "生成AI活用": "AI",
  "生成AI記事": "AI",
  "教育AI": "AI",
  "教育AI活用協会": "AI",
  "教育AIサミット": "AI",
  "教育AIサミット2025": "AI",
  "教育AIサミット2026": "AI",
  "教育A活用協会": "AI",
  "先生AIサミット": "AI",
  "ChatGPT": "AI",
  "ChatGPT Edu": "AI",
  "Claude": "AI",
  "Copilot": "AI",
  "GPT-5": "AI",
  "Gemini": "AI",
  "OpenAI": "AI",
  "Anthropic": "AI",
  "NotebookLM": "AI",
  "DeepL": "AI",
  "Genspark": "AI",
  "国産AI": "AI",
  "純国産AI": "AI",
  "都立AI": "AI",
  "赤本AI": "AI",
  "ブログ作成AI": "AI",
  "動画生成AI": "AI",
  "G検定": "AI",
  "日本ディープラーニング協会": "AI",
  "スクールAI": "AI",
  "スクールAI認定アドバイザー制度": "AI",
  "世界AI都市指数": "AI",
  "教育×AI": "AI",
  "教育とAI": "AI",
  "教室でのAI活用": "AI",
  "個別学習AI": "AI",
  "教師向けAIツール": "AI",
  
  // ICT・デジタル系 → ICT
  "ICT活用": "ICT",
  "ICT教育": "ICT",
  "教育ICT": "ICT",
  "ICTツール": "ICT",
  "ICT運用支援": "ICT",
  "ICT学習": "ICT",
  "ICT活用教育": "ICT",
  "ICT教材": "ICT",
  "ICT導入支援": "ICT",
  "ITリテラシー": "ICT",
  "IT活用": "ICT",
  "DX": "ICT",
  "DX推進": "ICT",
  "教育DX": "ICT",
  "校務DX": "ICT",
  "デジタル教育": "ICT",
  "デジタルツール": "ICT",
  "デジタル教科書": "ICT",
  "デジタル戦略": "ICT",
  "デジタル庁": "ICT",
  "デジ活": "ICT",
  "デジタル学習国際フォーラム": "ICT",
  "デジタル・ナレッジ": "ICT",
  "完全デジタル化": "ICT",
  "学校ICT": "ICT",
  "学校DX戦略アドバイザー": "ICT",
  "塾向けICT": "ICT",
  "塾向けICT教材": "ICT",
  "GIGAスクール": "ICT",
  "GIGAスクール構想": "ICT",
  "GIGAスクール構想第2期": "ICT",
  "EdTech": "ICT",
  "EdTechトレンド": "ICT",
  "エドテック": "ICT",
  "テクノロジー": "ICT",
  "テクノロジー教育": "ICT",
  "VR": "ICT",
  "XR": "ICT",
  "メタバース": "ICT",
  "メタバース・XR・AIアワード": "ICT",
  "バーチャル教室": "ICT",
  "タブレット": "ICT",
  "タブレット学習": "ICT",
  "タブレット端末": "ICT",
  "端末": "ICT",
  "端末管理サポート": "ICT",
  "電子機器": "ICT",
  "スマホ": "ICT",
  "スマホの与え方・使い方の教科書": "ICT",
  "マンスリースマホ": "ICT",
  "マンスリータブレット": "ICT",
  "電子出願": "ICT",
  "電子帳簿保存法": "ICT",
  "CBTシステム": "ICT",
  "LMS-学習管理": "ICT",
  "ネットワーク環境": "ICT",
  "ネット環境改善": "ICT",
  "データ活用": "ICT",
  "データ利活用": "ICT",
  "リアルタイム": "ICT",
  "リアルタイム学習モニタリング": "ICT",
  "進捗モニタリング": "ICT",
  "遠隔監視システム": "ICT",
  "一元管理システム": "ICT",
  "塾向けシステム": "ICT",
  "システムASSIST": "ICT",
  "セキュリティ対策": "ICT",
  "セキュリティ教育": "ICT",
  "セキュリティリスク": "ICT",
  "不正アクセス": "ICT",
  "情報流出": "ICT",
  "個人情報保護": "ICT",
  "不正防止": "ICT",
  "情報管理": "ICT",
  "情報Ⅰ": "ICT",
  "情報１": "ICT",
  "リテラシー教育": "ICT",
  "メディアリテラシー": "ICT",
  "隠し撮り": "ICT",
  "性犯罪対策": "ICT",
  
  // 塾系 → 塾
  "学習塾": "塾",
  "塾Cafe": "塾",
  "塾エイド": "塾",
  "塾シル": "塾",
  "塾の先生": "塾",
  "塾の先生向け": "塾",
  "塾運営": "塾",
  "塾経営": "塾",
  "塾経営改善": "塾",
  "塾講師": "塾",
  "塾カリキュラム再設計": "塾",
  "塾サイトの選び方": "塾",
  "塾指導": "塾",
  "塾教師養成": "塾",
  "塾教育": "塾",
  "塾教育の新しいアプローチ": "塾",
  "塾長の働き方": "塾",
  "塾長向け": "塾",
  "塾環境改善": "塾",
  "塾業界": "塾",
  "塾展開": "塾",
  "塾の入塾面談成功法": "塾",
  "塾の面談の極意": "塾",
  "塾の成功法則": "塾",
  "塾の利益構造": "塾",
  "塾の役割": "塾",
  "塾の教育方針": "塾",
  "塾の未来": "塾",
  "塾の競争力": "塾",
  "塾の経費管理": "塾",
  "塾の連絡帳": "塾",
  "塾の集客方法": "塾",
  "塾の面談対策": "塾",
  "塾のカリキュラム変革": "塾",
  "塾の保護者対応": "塾",
  "塾の入塾相談": "塾",
  "塾経営のコツ": "塾",
  "塾運営のベストプラクティス": "塾",
  "塾選びのコツ": "塾",
  "塾面談成功事例": "塾",
  "入塾率を上げる秘訣": "塾",
  "成功する塾": "塾",
  "塾探しの窓口": "塾",
  "効率的な塾運営": "塾",
  "教室運営": "塾",
  "教室": "塾",
  "入退室管理": "塾",
  "請求管理": "塾",
  "経費削減": "塾",
  "コストカット": "塾",
  "コスト削減": "塾",
  "法人税対策": "塾",
  "節税対策": "塾",
  "財務計画": "塾",
  "経営基盤": "塾",
  "経営安定化": "塾",
  "経営戦略": "塾",
  "経営課題": "塾",
  "安定した塾経営": "塾",
  "生き残り": "塾",
  "競争力強化": "塾",
  "差別化": "塾",
  "市場動向": "塾",
  "業界動向": "塾",
  "顧客目線": "塾",
  "顧客ニーズ": "塾",
  "顧客価値": "塾",
  "顧客満足度向上": "塾",
  "経営": "塾",
  "経営者": "塾",
  "ビジネスモデル": "塾",
  "フランチャイズ": "塾",
  "開業": "塾",
  "開業準備": "塾",
  "開校サポート": "塾",
  "独立開業": "塾",
  "起業戦略": "塾",
  "パートナー教室募集": "塾",
  "募集": "塾",
  "募集戦術": "塾",
  "秋季募集": "塾",
  "低学年集客": "塾",
  "新規生徒獲得": "塾",
  "マーケティング": "塾",
  "集客": "塾",
  "集客アイデア": "塾",
  "集客戦略": "塾",
  "集客支援": "塾",
  "集客方法": "塾",
  "SNS集客": "塾",
  "WEB集客": "塾",
  "SEO対策": "塾",
  "SEO戦略": "塾",
  "SNSマーケティング": "塾",
  "Googleビジネスプロフィール": "塾",
  "Googleマップ": "塾",
  "LP": "塾",
  "ホームページ": "塾",
  "サイトスピード": "塾",
  "モバイルフレンドリー": "塾",
  "ブログ": "塾",
  "ブログの作成方法": "塾",
  "口コミ": "塾",
  "口コミ対策": "塾",
  "評判対策": "塾",
  "不当な口コミ": "塾",
  "リアルなレビュー": "塾",
  "レビュー": "塾",
  "ランキング": "塾",
  "サービスの選び方": "塾",
  "サービス比較": "塾",
  "費用比較": "塾",
  "満足度": "塾",
  "ポスティング": "塾",
  "チラシ作成": "塾",
  "校門配布": "塾",
  "LINE広告": "塾",
  "ターゲティング": "塾",
  "ステマ規制": "塾",
  "景品表示法違反": "塾",
  "不当な表示": "塾",
  "ポータルサイト": "塾",
  "ポータルサイト業界": "塾",
  "一括資料請求": "塾",
  "業務効率化": "塾",
  "働き方改革": "ICT",
  "校務効率化": "ICT",
  "退塾者ゼロ": "塾",
  "退塾防止": "塾",
  "通塾": "塾",
  "通塾率": "塾",
  "ニッチ市場": "塾",
  "ワンオペ": "塾",
  "倒産": "塾",
  "資金調達": "塾",
  "投資": "塾",
  "個別指導塾": "塾",
  "個別指導塾LEADEST": "塾",
  "自立学習塾RED": "塾",
  "明光RED": "塾",
  "進学塾クエスト": "塾",
  "青楓館": "塾",
  "SS義塾": "塾",
  "武田塾": "塾",
  "あすなろ学習教室": "塾",
  "新星塾": "塾",
  "麻生塾": "塾",
  "名大SKY": "塾",
  "東大毎日塾": "塾",
  "ジュクサガス": "塾",
  "塾探しの窓口": "塾",
  
  // 学習系 → 学習
  "学習意欲": "学習",
  "学習意欲向上": "学習",
  "学習指導要領": "学習",
  "学習支援": "学習",
  "家庭学習": "学習",
  "家庭学習支援": "学習",
  "自宅学習": "学習",
  "パソコン学習": "学習",
  "タブレット学習": "ICT",
  "自学自習": "学習",
  "自立型": "学習",
  "能動的学習": "学習",
  "理解促進": "学習",
  "速読": "学習",
  "反復学習": "学習",
  "繰り返し学習": "学習",
  "学びの機会": "学習",
  "学びの多様性": "学習",
  "効果的な学び": "学習",
  "効率的学習": "学習",
  "成績向上": "学習",
  "成績アップ事例": "学習",
  "学力向上": "学習",
  "基礎学力": "学習",
  "演習": "学習",
  "問題演習": "学習",
  "暗記カード": "学習",
  "主体的な学び": "学習",
  "主体的学び": "学習",
  "21世紀型スキル": "学習",
  "アクティブラーニング": "学習",
  "創造的学習": "学習",
  "思考力向上": "学習",
  "思考力判断力表現力": "学習",
  "思考スキル開発": "学習",
  "論理思考": "学習",
  "アウトプット": "学習",
  "アウトプット重視の研修": "学習",
  "インプットとアウトプット": "学習",
  "モチベーションアップ": "学習",
  "内発的動機づけ": "学習",
  "動機付け": "学習",
  "学習意欲の向上": "学習",
  "意識改革": "学習",
  "自己管理": "学習",
  "自己成長": "学習",
  "自己探求": "学習",
  "自己啓発": "学習",
  "自主性尊重型教育": "学習",
  "自主的行動": "学習",
  "レベル分け": "学習",
  "習熟度別指導": "学習",
  "個別最適化": "学習",
  "適性評価": "学習",
  "能力評価": "学習",
  "定量化": "学習",
  "成果の可視化": "学習",
  "進捗モニタリング": "学習",
  
  // 受験・入試系 → 受験
  "受験生": "受験",
  "受験うつ": "受験",
  "受験の偏差値": "受験",
  "受験勉強": "受験",
  "受験成功": "受験",
  "受験指導": "受験",
  "受験生の志望理由": "受験",
  "受験生指導": "受験",
  "受験費用補助": "受験",
  "受験軸": "受験",
  "入試対策": "受験",
  "入試改革": "受験",
  "入試環境": "受験",
  "入試不正": "受験",
  "入試": "受験",
  "志望校のきっかけ": "受験",
  "志望理由書": "受験",
  "志望校選びのコツ": "受験",
  "合格": "受験",
  "合格ライン": "受験",
  "合格支援": "受験",
  "試験対策超越": "受験",
  "試験対策": "受験",
  "試験": "受験",
  "定期テスト": "受験",
  "模擬試験": "受験",
  "模擬試験実施": "受験",
  "模試費用補助": "受験",
  "確認テスト": "受験",
  "テスト対策": "受験",
  "テスト作成": "受験",
  "簡単テスト作成": "受験",
  "苦手科目対策": "受験",
  "受験対策": "受験",
  "受験対策超越": "受験",
  "偏差値教育": "受験",
  "受験戦争": "受験",
  "過熱受験戦争": "受験",
  "願書": "受験",
  "面談": "受験",
  "三者面談": "受験",
  "三者面談で使える質問": "受験",
  "三者面談質問例": "受験",
  "面談で親を落とすテクニック": "受験",
  "親を説得する方法": "受験",
  "進路指導": "受験",
  "総合型選抜": "受験",
  "小学校受験": "受験",
  "中学受験": "受験",
  "高校入試": "受験",
  "公立高校入試": "受験",
  "大学受験": "受験",
  "大学入試": "受験",
  "大学入学共通テスト": "受験",
  "東大受験": "受験",
  "東大合格": "受験",
  "関関同立合格": "受験",
  "東大": "大学",
  "北大": "大学",
  "立命館": "大学",
  "慶應大学": "大学",
  "慶応義塾大学": "大学",
  "東京都立大": "大学",
  "産業能率大学出版部": "大学",
  "河合塾": "受験",
  "駿台": "受験",
  "第一ゼミナール": "塾",
  "東進衛星予備校": "受験",
  "予備校": "受験",
  "赤本": "受験",
  "旺文社": "受験",
  "教学社": "受験",
  
  // 小学校系 → 小学校
  "小学生": "小学校",
  "小学生学習": "小学校",
  "小学生探究教育": "小学校",
  "公立小学校": "小学校",
  "小論文": "学習",
  "低学年": "小学校",
  
  // 中学系 → 中学
  "中学校": "中学",
  "中学生": "中学",
  "中学生学習": "中学",
  "小中学校": "中学",
  
  // 高校系 → 高校
  "高校教育": "高校",
  "高校生": "高校",
  "高校中退": "高校",
  "高校部": "高校",
  "高校連携": "高校",
  "普通科特色化": "高校",
  "N-E.X.T.ハイスクール構想": "高校",
  "通信制": "高校",
  "通信制高校サポート校": "高校",
  "フリースクール": "高校",
  "オルタナティブスクール": "高校",
  "高専": "高校",
  "茨城工業高等専門学校": "高校",
  "旭川高専": "高校",
  
  // 大学系 → 大学
  "大学生": "大学",
  "大学選び": "大学",
  "大学再編": "大学",
  "大学統合": "大学",
  "国立大学法人法": "大学",
  "大学法人法": "大学",
  "高大連携": "大学",
  "公立大学進学": "大学",
  "留学": "大学",
  "浪人生活": "受験",
  
  // 英語系 → 英語
  "英語教育": "英語",
  "英会話": "英語",
  "英検": "英語",
  "英検対策": "英語",
  "英作文": "英語",
  "英語4技能": "英語",
  "4技能": "英語",
  "英語リーディング": "英語",
  "英語学習": "英語",
  "英語学習法": "英語",
  "英語教室": "英語",
  "英語検定": "英語",
  "英語講師不要": "英語",
  "英語資格取得": "英語",
  "多読多聴": "英語",
  "TOEFL": "英語",
  "TOEIC": "英語",
  "DET": "英語",
  "ポケトーク": "英語",
  "NoLang": "英語",
  
  // プログラミング系 → プログラミング
  "プログラミング教育": "プログラミング",
  "プログラミング教室": "プログラミング",
  "プログラミング未経験": "プログラミング",
  "コードアドベンチャー": "プログラミング",
  "CodeCampKIDS": "プログラミング",
  "コードキャンプ株式会社": "プログラミング",
  "プロクラ": "プログラミング",
  "マインクラフト": "プログラミング",
  "ロボット": "プログラミング",
  "ロボット教室": "プログラミング",
  "エンジニア": "プログラミング",
  "現役エンジニア": "プログラミング",
  "起業家育成": "プログラミング",
  "アントレプレナーシップ": "プログラミング",
  "アントレ部": "プログラミング",
  "スタートアップ": "プログラミング",
  
  // オンライン系 → オンライン
  "オンライン学習": "オンライン",
  "オンライン授業": "オンライン",
  "オンラインコース": "オンライン",
  "オンラインサロン": "オンライン",
  "オンラインセミナー": "オンライン",
  "オンライン勉強会": "オンライン",
  "オンライン化": "オンライン",
  "オンライン学習塾": "オンライン",
  "オンライン対応": "オンライン",
  "オンライン指導": "オンライン",
  "オンライン授業支援": "オンライン",
  "オンライン教育": "オンライン",
  "オンライン自習室": "オンライン",
  "リモート学習": "オンライン",
  "リモート学習支援": "オンライン",
  "Zoom": "オンライン",
  "ZOOMセミナー": "オンライン",
  "LINE": "オンライン",
  "LINEWorks": "オンライン",
  "LINEヤフー": "オンライン",
  "LINE相談窓口": "オンライン",
  "先生たちのほっとLINE": "オンライン",
  "ハイブリッド": "オンライン",
  "ハイブリッド型教育": "オンライン",
  "ハイブリッド個別指導": "オンライン",
  "ブレイクアウトルーム": "オンライン",
  
  // セミナー・イベント系 → セミナー
  "ウェビナー": "セミナー",
  "無料セミナー": "セミナー",
  "セミナー・イベント": "セミナー",
  "セミナー、イベント告知": "セミナー",
  "勉強会": "セミナー",
  "ワークショップ": "セミナー",
  "セッション": "セミナー",
  "説明会": "セミナー",
  "情報交換会": "セミナー",
  "ポスターセッション": "セミナー",
  "キャンペーン": "セミナー",
  "紹介キャンペーン": "セミナー",
  "参加特典": "セミナー",
  "使い放題キャンペーン": "セミナー",
  "キックオフ": "セミナー",
  "モニター募集": "セミナー",
  "エントリー": "セミナー",
  "U-18": "セミナー",
  "U-18 AIチャンピオンシップ": "セミナー",
  "選手権大会": "セミナー",
  "全国高校サッカー選手権大会": "セミナー",
  "決勝": "セミナー",
  "最終選考会": "セミナー",
  "EXPO2025": "セミナー",
  "EXPO2025大阪・関西万博": "セミナー",
  "EXPOホール": "セミナー",
  "大阪・関西万博": "セミナー",
  "万博": "セミナー",
  "こども万博": "セミナー",
  "Interop": "セミナー",
  "Interop Tokyo": "セミナー",
  "幕張メッセ": "セミナー",
  "TALIS2024": "セミナー",
  "Edu-Bizチェンネル": "セミナー",
  "アイコレ": "セミナー",
  "サマーフェスティバル": "セミナー",
  "GW": "セミナー",
  "ゴールデンウィーク": "セミナー",
  "バレンタイン": "セミナー",
  "学校現場のAI活用実践コンテスト2025": "セミナー",
  "アーカイブ": "セミナー",
  "見逃し配信": "セミナー",
  "実況": "セミナー",
  "総括": "セミナー",
  
  // 保護者系 → 保護者
  "保護者対応": "保護者",
  "保護者連携": "保護者",
  "保護者連絡": "保護者",
  "保護者目線": "保護者",
  "親のプレッシャー": "保護者",
  "親の承認力": "保護者",
  "親の心を動かす質問": "保護者",
  "親子サポート": "保護者",
  "クレーム対応": "保護者",
  "子ども": "保護者",
  "子どもの安全": "保護者",
  "子どもの新たな一面": "保護者",
  "子どもの発達": "保護者",
  "子ども保護": "保護者",
  "子育て": "保護者",
  "子育て共育アドバイザー": "保護者",
  "共働き": "保護者",
  "幼児": "保護者",
  "幼児教育": "保護者",
  "早期教育": "保護者",
  "知育": "保護者",
  "知能開発": "保護者",
  "学校と家庭の連携": "保護者",
  "家計負担": "保護者",
  "教育費": "保護者",
  "学資保険": "保護者",
  "貯蓄": "保護者",
  "学費値上げ": "保護者",
  "学費免除": "保護者",
  "授業料実質無償化": "保護者",
  "経済的困難": "保護者",
  "低所得世帯": "保護者",
  "経済支援": "保護者",
  "経済対策": "保護者",
  "物価高騰": "保護者",
  
  // 教員・講師系 → 教員
  "教師": "教員",
  "教師研修": "教員",
  "教師研修プログラム": "教員",
  "教師向けAIツール": "教員",
  "教師の成長": "教員",
  "教師の人間力": "教員",
  "教師と生徒の関係": "教員",
  "教師インターンシップ": "教員",
  "教師労働環境": "教員",
  "先生": "教員",
  "教員研修": "教員",
  "教員": "教員",
  "教員休職対策": "教員",
  "教員働き方改革": "教員",
  "教員負担": "教員",
  "教員負担軽減": "教員",
  "講師研修": "教員",
  "講師採用": "教員",
  "講師不足": "教員",
  "講師管理": "教員",
  "講師環境改善": "教員",
  "講師用マニュアル": "教員",
  "講師研修の方法": "教員",
  "研修タイムスケジュール": "教員",
  "研修パッケージ": "教員",
  "自塾でできる研修": "教員",
  "自塾での研修実施": "教員",
  "プロフェッショナルデベロップメント": "教員",
  "社員育成": "教員",
  "社員採用": "教員",
  "人材育成": "教員",
  "人材確保": "教員",
  "人材不足解消": "教員",
  "指導方法": "教員",
  "指導報告書": "教員",
  "指導者向けツール": "教員",
  "効果的な指導法": "教員",
  "効果的な教育研修": "教員",
  "指導": "教員",
  "生徒指導": "教員",
  "個別指導": "教員",
  "個別指導の秘訣": "教員",
  "個別指導強化": "教員",
  "一斉個別指導": "教員",
  "一斉授業": "教員",
  "少人数指導": "教員",
  "スポット指導": "教員",
  "集団＋個別": "教員",
  "授業改善": "教員",
  "授業公開": "教員",
  "授業時間短縮": "教員",
  "授業展開の方法": "教員",
  "授業販売": "教員",
  "特別授業": "教員",
  "映像授業": "教員",
  "動画講義": "教員",
  "教えない塾": "教員",
  "伴走者": "教員",
  "コーチング": "教員",
  "コーチング技術": "教員",
  "コーチング研修": "教員",
  "コーチング思考": "教員",
  "コーチングスタディ": "教員",
  "傾聴スキル": "教員",
  "質問対応": "教員",
  "カウンセリング": "教員",
  "相談窓口": "教員",
  "悩み相談": "教員",
  "チャット相談": "教員",
  "相談チャット": "教員",
  "教職員": "教員",
  "学校管理職": "教員",
  "教育におけるリーダーシップ": "教員",
  "リーダーシップ": "教員",
  
  // 教材・ツール系 → 教材
  "教科書": "教材",
  "デジタル教科書": "教材",
  "小学校教科書": "教材",
  "教科書ナビ": "教材",
  "教科書改訂": "教材",
  "教科書準拠": "教材",
  "検定教科書準拠": "教材",
  "ゲーム型教材": "教材",
  "ICT教材": "教材",
  "天神教材": "教材",
  "天神": "教材",
  "手書き": "教材",
  "すらら": "教材",
  "すららドリル": "教材",
  "すららネット": "教材",
  "atama plus": "教材",
  "スタディサプリ": "教材",
  "スタディポケット": "教材",
  "進研ゼミ": "教材",
  "スマイルゼミ": "教材",
  "eboard": "教材",
  "manabo": "教材",
  "FitStudy": "教材",
  "Surala Math": "教材",
  "となりに東大生": "教材",
  "因材網": "教材",
  "Britannica School": "教材",
  "One Read": "教材",
  "OneStudy": "教材",
  "Canva": "教材",
  "Dr.okke": "教材",
  "Eye-Popper": "教材",
  "フォレスタ": "教材",
  "ウィングネット": "教材",
  "V-Growth": "教材",
  "ワンリード": "教材",
  "サス学": "教材",
  "サス学クラウドサービスSGX": "教材",
  "スマスタ": "教材",
  "読書教育サービス": "教材",
  "コエテコStudy": "教材",
  "Liew": "教材",
  "パズル": "教材",
  "積木": "教材",
  "エジソンクラブ": "教材",
  "全教科対応": "教材",
  "問題演習": "教材",
  "プリント対応": "教材",
  "読み上げ機能": "教材",
  "自動翻訳機能": "教材",
  "シャッフル機能": "教材",
  "動画販売": "教材",
  "通信教育": "教材",
  "習い事": "教材",
  
  // 補助金・制度系 → 補助金
  "補助プログラム": "補助金",
  "補助金活用": "補助金",
  "業務改善助成金": "補助金",
  "模試費用補助": "補助金",
  "授業料実質無償化": "補助金",
  "IT導入補助金": "補助金",
  "受験費用補助": "補助金",
  "探究・校務改革支援補助金2025": "補助金",
  "教育関係者向け 探究・校務改革支援補助金2025": "補助金",
  "給食": "補助金",
  "無償提供": "補助金",
  "導入費無料": "補助金",
  "初期費用不要": "補助金",
  "無料トライアル": "補助金",
  "レンタル": "補助金",
  "価格設定": "補助金",
  "授業料設定": "補助金",
  "授業料値上げ": "補助金",
  "授業料": "補助金",
  "費用対効果": "補助金",
  "柔軟な料金プラン": "補助金",
  "低コスト": "補助金",
  "導入コスト": "補助金",
  "成果報酬型": "補助金",
  "成約課金型": "補助金",
  
  // 地域系 → 地域
  "地域": "地域",
  "地域貢献": "地域",
  "地域特化": "地域",
  "地域連携": "地域",
  "田舎": "地域",
  "北海道": "地域",
  "青森県": "地域",
  "岩手県": "地域",
  "宮城県": "地域",
  "秋田県": "地域",
  "山形県": "地域",
  "福島県": "地域",
  "茨城県": "地域",
  "栃木県": "地域",
  "群馬県": "地域",
  "埼玉県": "地域",
  "千葉県": "地域",
  "東京都": "地域",
  "神奈川県": "地域",
  "新潟県": "地域",
  "富山県": "地域",
  "石川県": "地域",
  "福井県": "地域",
  "山梨県": "地域",
  "長野県": "地域",
  "岐阜県": "地域",
  "静岡県": "地域",
  "愛知県": "地域",
  "三重県": "地域",
  "滋賀県": "地域",
  "京都府": "地域",
  "大阪府": "地域",
  "兵庫県": "地域",
  "奈良県": "地域",
  "和歌山県": "地域",
  "鳥取県": "地域",
  "島根県": "地域",
  "岡山県": "地域",
  "広島県": "地域",
  "山口県": "地域",
  "徳島県": "地域",
  "香川県": "地域",
  "愛媛県": "地域",
  "高知県": "地域",
  "福岡県": "地域",
  "佐賀県": "地域",
  "長崎県": "地域",
  "熊本県": "地域",
  "大分県": "地域",
  "宮崎県": "地域",
  "鹿児島県": "地域",
  "沖縄県": "地域",
  "和歌山": "地域",
  "大阪": "地域",
  "東京": "地域",
  "沖縄": "地域",
  "札幌": "地域",
  "神戸": "地域",
  "名古屋": "地域",
  "品川": "地域",
  "武蔵浦和": "地域",
  "芦屋": "地域",
  "旭川": "地域",
  "ソウル": "地域",
  "ダナン": "地域",
  "フィラデルフィア": "地域",
  "ヘルシンキ": "地域",
  "北京": "地域",
  "宮城島": "地域",
  "カリフォルニア州": "地域",
  "ニューサウスウェールズ州": "地域",
  
  // 年度・その他
  "2025年": "2025年度",
  "2025年教育": "2025年度",
  "令和7年度": "2025年度",
  "eduplus+": "eduplus",
  "慶応義塾大学": "慶應大学",
  
  // 教育一般・その他
  "教育×AI": "AI",
  "教育とAI": "AI",
  "教育": "教育",
  "教育改革": "教育",
  "教育業界": "教育",
  "教育現場": "教育",
  "教育サービス": "教育",
  "次世代教育": "教育",
  "公教育": "教育",
  "民間教育": "教育",
  "学校": "教育",
  "学校寄贈": "教育",
  "学校連携": "教育",
  "公立学校": "教育",
  "義務教育学校": "教育",
  "専門学校": "教育",
  "専門教育": "教育",
  "全人的教育": "教育",
  "グローバル教育": "教育",
  "国際バカロレア": "教育",
  "海外教育": "教育",
  "アフタースクール": "教育",
  "キッズスクール": "教育",
  "スクール": "教育",
  "放課後デイサービス": "教育",
  "キャリア教育": "教育",
  "探究教育": "教育",
  "探究学舎": "教育",
  "探究・キャリア教育": "教育",
  "総合的な探究": "教育",
  "探究学習": "教育",
  "探究学習支援": "教育",
  "探究授業": "教育",
  "探究サービス": "教育",
  "探求学習": "教育",
  "体験型授業": "教育",
  "金融教育": "教育",
  "環境教育": "教育",
  "食育": "教育",
  "体育": "教育",
  "スポーツ": "教育",
  "部活動": "教育",
  "サッカー部": "教育",
  "アスリート": "教育",
  "スピードスケート": "教育",
  "読解力養成": "教育",
  "活字と漫画のバランス": "教育",
  "漫画と学習": "教育",
  "漫画の教育効果": "教育",
  "多様性": "教育",
  "SDGs": "教育",
  "ライフスタイル": "教育",
  "やりがい": "教育",
  "県外流出": "教育",
  "統廃合": "教育",
  "学級減少": "教育",
  "少子化時代": "教育",
  "少子化対策": "教育",
  "新設構想": "教育",
  "ガバナンス": "教育",
  "コンプライアンス": "教育",
  "法規制": "教育",
  "法的対応": "教育",
  "公正": "教育",
  "公平性": "教育",
  "社会的責任": "教育",
  "責任分担の明確化": "教育",
  "組織文化": "教育",
  "独立性": "教育",
  "イノベーション戦略": "教育",
  "進化": "教育",
  "令和の虎": "教育",
  "ドラゴン桜": "教育",
  "おすすめ書籍": "教育",
  "出版": "教育",
  "出版記念": "教育",
  "新刊": "教育",
  "note": "教育",
  "YouTube": "教育",
  "YouTubeビジネス": "教育",
  "Instagram": "教育",
  "TikTok": "教育",
  "SNS": "教育",
  "メルマガ": "教育",
  "メール文面": "教育",
  "メッセージ送信": "教育",
  "情報配信": "教育",
  "お役立ち情報": "教育",
  "サービスPR": "教育",
  "サービス一覧": "教育",
  "サービス開発": "教育",
  "サービス事業者": "教育",
  "サービス紹介": "教育",
  "実証実験": "教育",
  "パイロットプログラム": "教育",
  "成功事例": "教育",
  "実践事例": "教育",
  "事例紹介": "教育",
  "成功事例活用": "教育",
  "実例大全": "教育",
  "現場ノウハウ": "教育",
  "秘訣": "教育",
  "コツ": "教育",
  "ベストプラクティス": "教育",
  "ロードマップ": "教育",
  "目的と理由": "教育",
  "目的の明確化": "教育",
  "目的引き出し": "教育",
  "目標設定": "教育",
  "信頼": "教育",
  "信頼構築": "教育",
  "コミュニケーション": "教育",
  "コミュニケーションスキル": "教育",
  "コミュニケーション強化": "教育",
  "コミュニケーション能力": "教育",
  "教育におけるコミュニケーションスキル": "教育",
  "コミュニティ": "教育",
  "つなぐ": "教育",
  "包括連携": "教育",
  "連携協定": "教育",
  "産学連携": "教育",
  "産学官連携": "教育",
  "共同研究": "教育",
  "メンタルヘルス": "教育",
  "メンタルサポート": "教育",
  "メンタル不調防止": "教育",
  "心のケア": "教育",
  "心理カウンセリング": "教育",
  "心理的サポート": "教育",
  "ストレスマネジメント": "教育",
  "カスタマーハラスメント": "教育",
  "カスハラ": "教育",
  "いじめ": "教育",
  "虐待防止": "教育",
  "性犯罪": "教育",
  "性犯罪防止": "教育",
  "性暴力": "教育",
  "日本版DBS": "教育",
  "日本版DBS制度": "教育",
  "任意制度": "教育",
  "不登校": "教育",
  "不登校支援": "教育",
  "出席扱い認定": "教育",
  "自殺問題": "教育",
  "闇授業": "教育",
  "体罰": "教育",
  "安全な学習空間": "教育",
  "安全対策": "教育",
  "安全文化": "教育",
  "健康的な学習環境": "教育",
  "感染症対策": "教育",
  "インフルエンザ": "教育",
  "予防接種": "教育",
  "食事管理": "教育",
  "コロナ禍": "教育",
  "避難訓練": "教育",
  "火災": "教育",
  "監視体制": "教育",
  "留守番禁止": "教育",
  "非認知能力": "教育",
  "教育における自己成長": "教育",
  "自己PR": "教育",
  "自己評価": "教育",
  "宇宙": "教育",
  "建築学科": "教育",
  "建築学部": "教育",
  "算数": "教育",
  "数学": "教育",
  "数学基礎": "教育",
  "理科": "教育",
  "社会": "教育",
  "国語": "教育",
  "文理": "教育",
  "文理融合": "教育",
  "通知表廃止": "教育",
  "所見作成": "教育",
  "報告書作成": "教育",
  "判定システム": "教育",
  "PDCAサイクル": "教育",
  "G-PDCAサイクル": "教育",
  "長期的視点": "教育",
  "長期的関係": "教育",
  "新年メッセージ": "教育",
  "意識調査": "教育",
  "調査結果": "教育",
  "最新調査": "教育",
  "ニュース考察": "教育",
  "注目": "教育",
  "5大ニュース": "教育",
  "Z世代": "教育",
  "Z世代考察": "教育",
  "女子学生": "教育",
  "13歳": "教育",
  "U-18": "教育",
  "ジェネラリスト検定": "教育",
  "規範意識": "教育",
  "ガイドライン": "教育",
  "マニフェスト": "教育",
  "国家戦略": "教育",
  "コンサルタント": "教育",
  "アドバイザー": "教育",
  "プレゼンター": "教育",
  "プレッシャー": "教育",
  "ユーザーフレンドリー": "教育",
  "コンパクト": "教育",
  "シンプル": "教育",
  "インセンティブ": "教育",
  "利益増加": "教育",
  "成果報酬": "教育",
  "福祉事業": "教育",
  "社労士": "教育",
  "従業員管理": "教育",
  "詐欺被害": "教育",
  "問題流出": "教育",
  "不正行為": "教育",
  "リスク管理": "教育",
  "バックアップ": "教育",
  "故障": "教育",
  "省エネ": "教育",
  "スマートグラス": "教育",
  "スーパーコンピューター": "教育",
  "図書館": "教育",
  "宿題": "教育",
  "自由研究": "教育",
  "夏期講習": "教育",
  "春期講習": "教育",
  "夏休み": "教育",
  "夏休み明け": "教育",
  "10年": "教育",
  "1ヶ月単位": "教育",
  "24時間対応": "教育",
  "1大学2校": "教育",
  
  // 企業・組織・製品名（大統合: 主要企業名以外は統合先カテゴリへ）
  "エデュプラス": "教育",
  "エデュマッチ": "教育",
  "ベネッセ": "教材",
  "ベネッセコーポレーション": "教材",
  "Gakken": "教材",
  "学研": "教材",
  "小学館": "教材",
  "インプレス": "教材",
  "啓林館": "教材",
  "東京書籍": "教材",
  "ヒューマンアカデミー": "教材",
  "コクヨ": "教材",
  "内田洋行": "教材",
  "菅公学生服": "教材",
  "栢森教育研究所": "教材",
  "Microsoft": "ICT",
  "マイクロソフト": "ICT",
  "Google": "ICT",
  "Google for Education": "ICT",
  "Amazon": "ICT",
  "AWS": "ICT",
  "NTT": "ICT",
  "NTT西日本": "ICT",
  "NEC": "ICT",
  "NECソリューションイノベータ": "ICT",
  "富士通Japan": "ICT",
  "GMO": "ICT",
  "GMOメディア": "ICT",
  "さくらインターネット": "ICT",
  "コニカミノルタ": "ICT",
  "NVIDIA": "ICT",
  "ASUS": "ICT",
  "インテル": "ICT",
  "テスラ": "ICT",
  "テスラジャパン": "ICT",
  "テスラミッション": "ICT",
  "ECC": "英語",
  "博報堂": "教育",
  "フューチャー株式会社": "ICT",
  "ブリタニカ・ジャパン株式会社": "教材",
  "モノグサ": "教材",
  "wagaco": "教材",
  "ユニバープラス": "教材",
  "チームみらい": "教育",
  "officeKANNO": "教育",
  "studio veco": "教育",
  "noiz": "教育",
  "IKIGAI lab.": "教育",
  "DreamDriven": "教育",
  "エイムアット": "教育",
  "SRJ": "教育",
  "GAIS": "教育",
  "GDLS": "教育",
  "CDLE": "教育",
  "こうべデジタル活動部": "地域",
  "グランシップ": "地域",
  "こどもとIT": "教育",
  "みんがく": "教育",
  "Meta Heroes": "AI",
  "いちばんやさしいCanva教育版の教本": "教材",
  
  // 国・地域
  "アメリカ": "地域",
  "米国": "地域",
  "イギリス": "地域",
  "英国": "地域",
  "カナダ": "地域",
  "オーストラリア": "地域",
  "ニュージーランド": "地域",
  "フィンランド": "地域",
  "デンマーク": "地域",
  "ドイツ": "地域",
  "フランス": "地域",
  "エストニア": "地域",
  "シンガポール": "地域",
  "韓国": "地域",
  "中国": "地域",
  "台湾": "地域",
  "インド": "地域",
  "ベトナム": "地域",
  "カンボジア": "地域",
  "ウズベキスタン": "地域",
  "カザフスタン": "地域",
  "サウジアラビア": "地域",
  "アラブ首長国連邦": "地域",
  "UAE": "地域",
  "エジプト": "地域",
  "ナイジェリア": "地域",
  "アフリカ": "地域",
  "日本": "地域",
  
  // 政府・公的機関
  "文科省": "教育",
  "文部科学省": "教育",
  "経済産業省": "教育",
  "総務省": "教育",
  "総務大臣賞": "教育",
  "東京都教育委員会": "教育",
  "国立教育政策研究所": "教育",
  "経済協力開発機構": "教育",
  "OECD": "教育",
  "国際教員指導環境調査": "教育",
  "日本青少年育成協会": "教育",
  "青年会議所": "教育",
  "先端科学技術研究センター": "教育",
  
  // その他細かいタグは除外リストへ移動
};

// 2. 除外するタグ（個人名・特定イベント1回限り・ノイズ）
const excludeSet = new Set([
  "佐藤雄太",
  "安井政樹",
  "安藤昇",
  "安野たかひろ",
  "岩井 良明",
  "岡崎朋美",
  "島田陽輔",
  "木村吉宏",
  "松尾豊",
  "濵田英毅",
  "炭谷俊樹",
  "池田朋弘",
  "稲垣忠",
  "藤原和博",
  "野本一真",
  "鈴木秀樹",
  "宇都宮らいく",
  "安河内哲也",
  "平井聡一郎",
  "投稿者名",
  "レイの失踪",
  "前川先生",
  "御上先生",
  "写メQ先生",
  "aim@",
  "ノイズ",
  "癖",
  "元旦",
  "年頭所感",
  "参院選",
  "トランプ",
  "条例案",
  "衆議院第一議員会館",
  "いけとも",
  "東証プライム",
  // 年度は残すので除外しない
  // "2023年", "2025年度", "2026年" は残す
]);

// 3. 都道府県は「地域」にまとめるのでprefecturesチェック不要

// 4. 市区町村・細かい地域は除外
function isSmallRegion(name) {
  if (/^.+(市|区|町|村)$/.test(name)) return true;
  return false;
}

// 5. 株式会社〇〇 / 合同会社〇〇 は除外
function isDroppableCompany(name) {
  return /^株式会社/.test(name) || /^合同会社/.test(name);
}

// 6. 特定の大学名・高校名・学校法人名（汎用の「大学」「高校」は残す）
function isSpecificSchool(name) {
  if (name === "大学" || name === "高校" || name === "小学校" || name === "中学校" || name === "専門学校") return false;
  if (/大学$/.test(name) || /高校$/.test(name) || /高等学校$/.test(name) || /学園$/.test(name) || /学院$/.test(name)) return true;
  return false;
}

// 7. 長すぎるタグ（30文字超）
function isTooLong(name) {
  return name.length > 30;
}

// 正規化
tags = tags.map(t => normalizeMap[t] || t);

// 除外
tags = tags.filter(t => {
  if (excludeSet.has(t)) return false;
  if (isSmallRegion(t)) return false;
  if (isDroppableCompany(t)) return false;
  if (isSpecificSchool(t)) return false;
  if (isTooLong(t)) return false;
  return true;
});

// 重複削除
tags = [...new Set(tags)];

// 最終フィルタ: 最終カテゴリのみ残す（年度タグ3つは例外で残す）
const ALLOWED_TAGS = new Set([...FINAL_CATEGORIES, "2023年", "2025年度", "2026年"]);
tags = tags.filter(t => ALLOWED_TAGS.has(t));

// ソート
tags = tags.sort();

console.log(`Before: 1434`);
console.log(`After: ${tags.length}`);
console.log(`Removed: ${1434 - tags.length}`);

// 出力（カテゴリ用に変更）
const sqlPath = path.join(__dirname, "../supabase/migrations/seed_article_categories.sql");
const listPath = path.join(__dirname, "../data/article-categories-optimized.txt");
const tsPath = path.join(__dirname, "../src/lib/article-categories.ts");

// SQL
let sql = `-- ArticleCategory 固定カテゴリ（${tags.length}件）\n`;
sql += `-- 記事・サービスのカテゴリ選択肢として利用\n`;
sql += `-- タグ（tags配列）とは別管理\n\n`;
sql += `INSERT INTO public."ArticleCategory" ("name", "sort_order")\nVALUES\n`;
sql += tags.map((t, i) => `  ('${t.replace(/'/g, "''")}', ${i})`).join(",\n");
sql += `\nON CONFLICT ("name") DO NOTHING;\n`;
fs.writeFileSync(sqlPath, sql, "utf-8");

// リスト
fs.writeFileSync(listPath, tags.join("\n") + "\n", "utf-8");

// TypeScript
let ts = `/** 記事・サービスの固定カテゴリ（22個） */\n`;
ts += `/** Post.category / Service.category で使用。タグ（Post.tags / Service.tags）とは別管理 */\n`;
ts += `export const ARTICLE_CATEGORIES = [\n`;
ts += tags.map(t => `  "${t.replace(/"/g, '\\"')}"`).join(",\n");
ts += `\n] as const;\n\n`;
ts += `export type ArticleCategory = (typeof ARTICLE_CATEGORIES)[number];\n\n`;
ts += `/** カテゴリ文字列の検証 */\n`;
ts += `export function isValidArticleCategory(value: string): value is ArticleCategory {\n`;
ts += `  return ARTICLE_CATEGORIES.includes(value as ArticleCategory);\n`;
ts += `}\n\n`;
ts += `/** TSVパース用 */\n`;
ts += `export function parseArticleCategoryFromTsv(value: string): ArticleCategory | null {\n`;
ts += `  const trimmed = value.trim();\n`;
ts += `  if (!trimmed) return null;\n`;
ts += `  return isValidArticleCategory(trimmed) ? trimmed : null;\n`;
ts += `}\n`;
fs.writeFileSync(tsPath, ts, "utf-8");

console.log(`Written: ${sqlPath}`);
console.log(`List: ${listPath}`);
console.log(`TypeScript: ${tsPath}`);
